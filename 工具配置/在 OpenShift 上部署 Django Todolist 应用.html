<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/typo.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/reset_typo.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/static/images/favicon.ico" type="image/x-icon">
        <title>在 OpenShift 上部署 Django Todolist 应用 - Wiki | Small Cpp</title>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container" class="typo">
            
    <div id="header">
        <div id="post-nav">
            
            <a href="/">Home</a> » <a href="/#工具配置">工具配置</a> » 在 OpenShift 上部署 Django Todolist 应用
            
        </div>
    </div>
    <div class="clearfix"></div>
    <div id="content">
        <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#openshift-django">一、初始化 Openshift Django 应用</a></li>
<li><a href="#django">二、配置默认的 Django</a></li>
<li><a href="#todolist">三、安装 todolist 项目</a></li>
<li><a href="#diy-todolist">四、DIY todolist</a></li>
<li><a href="#_1">五、最后</a></li>
</ul>
</div>
<h1 id="openshift-django">一、初始化 Openshift Django 应用</h1>
<p>首先去 Openshift 上创建一个 Django 应用, 关于怎么创建 Openshift 应用参考我<a href="http://www.smallcpp.com/wan-jie-ba-tan-xi-qiang-you-ya-de-fan-qiang.html">另一篇笔记</a></p>
<p>我这里创建了一个 <code>todolist-smallcpp.rhcloud.com</code>, 然后, 利用<a href="http://www.smallcpp.com/wan-jie-ba-tan-xi-qiang-you-ya-de-fan-qiang.html">另一篇笔记</a>的知识用 SecureCRT 连上我们的服务器.</p>
<p><strong>补充一下用 putty.exe 连接的方法.</strong></p>
<p>首先, 和<a href="http://www.smallcpp.com/wan-jie-ba-tan-xi-qiang-you-ya-de-fan-qiang.html">另一篇笔记</a>中一样, 通过 <a href="http://www.smallcpp.com/git-jian-ming-shou-ce.html#101-ssh-key">Git 简明手册</a> 拿到了两个密钥文件: id_rsa(私钥) 和 id_rsa.pub(公钥), 将 id_rsa.pub(公钥) 部署到刚创建的 Django 应用上.</p>
<p>putty.exe 不能识别直接从服务器拷贝来的私钥, 需要使用 <code>puttygen.exe</code> 进行格式转换.</p>
<ul>
<li>开 puttygen.exe --> Conversions --> Import Key</li>
<li>选择私钥文件 id_rsa</li>
<li>Save private key -> id_rsa.ppk (保存私钥)</li>
</ul>
<p>最后, 打开 putty.exe</p>
<ul>
<li>Session --> Host Name (填写服务器地址或者域名)</li>
<li>Connection --> SSH --> Auth (点 Browse 选择刚生成的 id_rsa.ppk)</li>
<li>Connection --> Data (填写 Auto-login username)</li>
<li>open</li>
</ul>
<p>成功连接后出现下面这样的提示:</p>
<div class="hlcode"><pre><span class="n">login</span> <span class="n">as</span><span class="o">:</span> <span class="n">your</span> <span class="n">login</span> <span class="n">user</span> <span class="n">name</span>
<span class="n">Authenticating</span> <span class="n">with</span> <span class="n">public</span> <span class="n">key</span> <span class="s">&quot;imported-openssh-key&quot;</span>
<span class="p">...</span>
<span class="p">[</span><span class="n">todolist</span><span class="o">-</span><span class="n">smallcpp</span><span class="p">.</span><span class="n">rhcloud</span><span class="p">.</span><span class="n">com</span> <span class="n">your</span> <span class="n">login</span> <span class="n">user</span> <span class="n">name</span><span class="p">]</span><span class="err">\</span><span class="o">&gt;</span>
</pre></div>


<p><br></p>
<h1 id="django">二、配置默认的 Django</h1>
<p>用 Openshift 创建的 Django 应用默认有一个 <code>Hello World</code> (你懂的...), 但此时我们直接访问 <a href="https://todolist-smallcpp.rhcloud.com">https://todolist-smallcpp.rhcloud.com</a> 是会报错的...需要配置下.</p>
<p>我们先用 git 把 Openshift 上的 Django 项目 pull 回本地 (git 地址在创建应用时网站上会提示), 该项目目录如下:</p>
<p><img alt="" src="http://i66.tinypic.com/zvu6o3.jpg" /></p>
<p>里面有个 <code>Readme.md</code>, 阅读后发现下面这些信息:</p>
<ul>
<li>Django project name 是 myproject (在 wsgi 目录下)</li>
<li>数据库保存在 $OPENSHIFT_DATA_DIR/db.sqlite3 ($OPENSHIFT_DATA_DIR 是一个 Link, 指向 app-root/data)</li>
<li>初次使用, 必须创建/修改 admin 的密码<ul>
<li><code>python $OPENSHIFT_REPO_DIR/wsgi/myproject/manage.py createsuperuser</code> ($OPENSHIFT_REPO_DIR 是一个 Link, 指向 app-root/runtime/repo)</li>
<li>登录地址: <a href="https://todolist-smallcpp.rhcloud.com/admin">https://todolist-smallcpp.rhcloud.com/admin</a></li>
</ul>
</li>
<li>要注意使用 <code>python $OPENSHIFT_REPO_DIR/wsgi/myproject/manage.py syncdb</code> 同步数据库<ul>
<li>由于 <code>syncdb</code> 的尿性, 如果修改了数据库结构, 需要先执行 <code>rm -f $OPENSHIFT\_DATA\_DIR/db.sqlite3</code></li>
<li>关于 <code>syncdb</code> 的说明参考我另一篇笔记 <code>44. Django migration vs syncdb</code></li>
</ul>
</li>
</ul>
<h1 id="todolist">三、安装 todolist 项目</h1>
<p>todolist 我弄了个<a href="https://github.com/zongxiao/Django-Simple-Todo">开源的源码</a>, clone 到本地, 将目录更名为 <code>todolist</code> 并放到步骤二 pull 回本地的 Django 项目根目录的 <code>wsgi</code> 目录下, 并删除自带的 <code>myproject</code> 目录 (注意, 备份下 <code>myproject</code> 里的 <code>settings.py</code>, 后面有用).</p>
<p><img alt="" src="http://i67.tinypic.com/2ijixar.jpg" /></p>
<p><img alt="" src="http://i63.tinypic.com/24yza51.jpg" /></p>
<p><img alt="" src="http://i67.tinypic.com/j0fyc9.jpg" /></p>
<p>然后有几个关键地方要配置:</p>
<p>首先是 <code>setup.py</code> 文件, 其中有一项 <code>install_requires</code> 很重要, 它表示项目中用到的第三方 python 库, 填在里面的项 push 到 openshift 后, openshift 会自动调用 easy_install 进行安装, 例如:</p>
<div class="hlcode"><pre><span class="n">install_requires</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Django&lt;=1.8&#39;</span><span class="p">,</span> <span class="s">&#39;django-markdown&#39;</span><span class="p">,</span> <span class="s">&#39;django-markdown-deux==1.0.5&#39;</span><span class="p">,</span> <span class="s">&#39;markdown2==2.3.0&#39;</span><span class="p">,</span> <span class="s">&#39;markdown&#39;</span><span class="p">]</span>
</pre></div>


<p><br>
然后打开 <code>\todolist\.openshift\action_hooks</code> 目录下的 <code>deploy</code> 文件, 这里面保存的是当 push 到 openshift 后执行的动作, 我们把里面的 <code>myproject</code> 改为 <code>todolist</code>.</p>
<div class="hlcode"><pre><span class="c">#!/bin/bash</span>
<span class="c"># This deploy hook gets executed after dependencies are resolved and the</span>
<span class="c"># build hook has been run but before the application has been started back</span>
<span class="c"># up again.  This script gets executed directly, so it could be python, php,</span>
<span class="c"># ruby, etc.</span>

<span class="k">if</span> <span class="p">[</span> <span class="err">!</span> <span class="o">-</span><span class="n">f</span> <span class="s">&quot;$OPENSHIFT_DATA_DIR&quot;</span><span class="n">secrets</span><span class="o">.</span><span class="n">json</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">&quot;Generating $OPENSHIFT_DATA_DIR/secrets.json&quot;</span>
    <span class="n">python</span> <span class="s">&quot;$OPENSHIFT_REPO_DIR&quot;</span><span class="n">libs</span><span class="o">/</span><span class="n">secrets</span><span class="o">.</span><span class="n">py</span> <span class="o">&gt;</span> <span class="s">&quot;$OPENSHIFT_DATA_DIR&quot;</span><span class="n">secrets</span><span class="o">.</span><span class="n">json</span>
<span class="n">fi</span>

<span class="c"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span class="n">echo</span> <span class="s">&quot;Executing &#39;python $OPENSHIFT_REPO_DIR/wsgi/todolist/manage.py migrate --noinput&#39;&quot;</span>
<span class="c"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span class="n">python</span> <span class="s">&quot;$OPENSHIFT_REPO_DIR&quot;</span><span class="n">wsgi</span><span class="o">/</span><span class="n">todolist</span><span class="o">/</span><span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span> <span class="o">--</span><span class="n">noinput</span>

<span class="c"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span class="n">echo</span> <span class="s">&quot;Executing &#39;python $OPENSHIFT_REPO_DIR/wsgi/todolist/manage.py collectstatic --noinput&#39;&quot;</span>
<span class="c"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span class="n">python</span> <span class="s">&quot;$OPENSHIFT_REPO_DIR&quot;</span><span class="n">wsgi</span><span class="o">/</span><span class="n">todolist</span><span class="o">/</span><span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">collectstatic</span> <span class="o">--</span><span class="n">noinput</span>
</pre></div>


<p><br>
再进入 <code>wsgi</code> 文件夹, 里面有个 <code>application</code> 的文件</p>
<div class="hlcode"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c">## GETTING-STARTED: make sure the next line points to your settings.py:</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;openshift.settings&#39;</span>
<span class="c">## GETTING-STARTED: make sure the next line points to your django project dir:</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSHIFT_REPO_DIR&#39;</span><span class="p">],</span> <span class="s">&#39;wsgi&#39;</span><span class="p">,</span> <span class="s">&#39;openshift&#39;</span><span class="p">))</span>
<span class="n">virtenv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;APPDIR&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/virtenv/&#39;</span>
<span class="c">## GETTING-STARTED: make sure the next line has the right python version:</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PYTHON_EGG_CACHE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">virtenv</span><span class="p">,</span> <span class="s">&#39;lib/python2.7/site-packages&#39;</span><span class="p">)</span>
<span class="n">virtualenv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">virtenv</span><span class="p">,</span> <span class="s">&#39;bin/activate_this.py&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">virtualenv</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__file__</span><span class="o">=</span><span class="n">virtualenv</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">import</span> <span class="nn">django.core.wsgi</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">get_wsgi_application</span><span class="p">()</span>
</pre></div>


<p><br>
注意这两行:</p>
<div class="hlcode"><pre><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;myproject.settings&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSHIFT_REPO_DIR&#39;</span><span class="p">],</span> <span class="s">&#39;wsgi&#39;</span><span class="p">,</span> <span class="s">&#39;myproject&#39;</span><span class="p">))</span>
</pre></div>


<p><br>
改为:</p>
<div class="hlcode"><pre><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;simple_todo.settings&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSHIFT_REPO_DIR&#39;</span><span class="p">],</span> <span class="s">&#39;wsgi&#39;</span><span class="p">,</span> <span class="s">&#39;todolist&#39;</span><span class="p">))</span>
</pre></div>


<p><br>
<strong>注意</strong>, 别改错了,  第一个是 <code>simple_todo.settings</code>, 别改成 <code>todolist.settings</code> 了.</p>
<p>最后, 进入 <code>\todolist\wsgi\todolist\simple_todo</code> 目录, 用之前从 <code>myproject</code> 里备份的 <code>settings.py</code> 替换掉 <code>simple_todo</code> 里的 <code>settings.py</code>.<br>
但要做下修改, 把 <code>settings.py</code> 里的 <code>myproject</code> 替换成 <code>simple_todo</code>, 然后在 <code>INSTALLED_APPS</code> 里添加一项 <code>todo</code>, 再把 <code>Debug</code> 属性改为 <code>False</code> (如果部署到 openshift 后发现有问题, 可以改为 <code>True</code> 后进行调试, 调试完毕再改为 <code>False</code>), 改完后的 <code>settings.py</code> 如下:</p>
<div class="hlcode"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Django settings for simple_todo project.</span>

<span class="sd">For more information on this file, see</span>
<span class="sd">https://docs.djangoproject.com/en/1.8/topics/settings/</span>

<span class="sd">For the full list of settings and their values, see</span>
<span class="sd">https://docs.djangoproject.com/en/1.8/ref/settings/</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">DJ_PROJECT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">DJ_PROJECT_DIR</span><span class="p">)</span>
<span class="n">WSGI_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">)</span>
<span class="n">REPO_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">WSGI_DIR</span><span class="p">)</span>
<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;OPENSHIFT_DATA_DIR&#39;</span><span class="p">,</span> <span class="n">BASE_DIR</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">REPO_DIR</span><span class="p">,</span> <span class="s">&#39;libs&#39;</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">secrets</span>
<span class="n">SECRETS</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s">&#39;secrets.json&#39;</span><span class="p">))</span>

<span class="c"># Quick-start development settings - unsuitable for production</span>
<span class="c"># See https://docs.djangoproject.com/en/1.8/howto/deployment/checklist/</span>

<span class="c"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">SECRETS</span><span class="p">[</span><span class="s">&#39;secret_key&#39;</span><span class="p">]</span>

<span class="c"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="n">DEBUG</span>

<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">gethostname</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gethostname</span><span class="p">(),</span> <span class="c"># For internal OpenShift load balancer security purposes.</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;OPENSHIFT_APP_DNS&#39;</span><span class="p">),</span> <span class="c"># Dynamically map to the OpenShift gear name.</span>
    <span class="c">#&#39;example.com&#39;, # First DNS alias (set up in the app)</span>
    <span class="c">#&#39;www.example.com&#39;, # Second DNS alias (set up in the app)</span>
<span class="p">]</span>


<span class="c"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s">&#39;todo&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># GETTING-STARTED: change &#39;simple_todo&#39; to your project name:</span>
<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">&#39;simple_todo.urls&#39;</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s">&#39;simple_todo.wsgi.application&#39;</span>

<span class="c"># Database</span>
<span class="c"># https://docs.djangoproject.com/en/1.8/ref/settings/#databases</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="c"># GETTING-STARTED: change &#39;db.sqlite3&#39; to your sqlite3 database:</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Internationalization</span>
<span class="c"># https://docs.djangoproject.com/en/1.8/topics/i18n/</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">&#39;en-us&#39;</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">&#39;UTC&#39;</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="bp">True</span>


<span class="c"># Static files (CSS, JavaScript, Images)</span>
<span class="c"># https://docs.djangoproject.com/en/1.8/howto/static-files/</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">&#39;/static/&#39;</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WSGI_DIR</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">)</span>
</pre></div>


<p><br>
<strong>静态文件的处理</strong></p>
<p>比如 CSS、图片等等, 一般 Django 应用的静态文件的目录是在 settings.py 中配置的, 但是 OpenShift 使用了不一样的方式, 所有的静态文件都将被放置在 <code>wsgi/static</code> 目录下.</p>
<blockquote>
<p>貌似在 openshift 中, css 文件中的 url 属性不生效, 我现在把 css 中的 url 属性都移到 html 标签中嵌套了...</p>
</blockquote>
<h1 id="diy-todolist">四、DIY todolist</h1>
<p>上面的开源项目基于实现了 todolist 的功能, 不好的是暂时缺少用户管理系统 (所有人访问都是同一个 todolist), 所以准备 DIY 一下, 加一个用户系统.</p>
<h1 id="_1">五、最后</h1>
<p>重要的事再说一次:</p>
<p>由于 <code>syncdb</code> 的尿性, 如果修改了数据库结构, 需要先执行 <code>rm -f $OPENSHIFT\_DATA\_DIR/db.sqlite3</code>, 再执行次 <code>python $OPENSHIFT_REPO_DIR/wsgi/myproject/manage.py syncdb</code>.</p>
<p>修改后的项目, 我放在 git@oschina 上了, 可以参考参考...</p>
    </div>

    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="在 OpenShift 上部署 Django Todolist 应用" data-title="在 OpenShift 上部署 Django Todolist 应用" data-url="http://wiki.smallcpp.com/工具配置/在 OpenShift 上部署 Django Todolist 应用.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"smallwiki"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共JS代码 end -->


        </div>
        <div id="footer">
              <p>
                Copyright © 2012-2016 <a href="http://www.samllcpp.com/" target="_blank">Martin</a> Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
              </p>
        </div>
    </body>
</html>